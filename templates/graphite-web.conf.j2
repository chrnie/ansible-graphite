#
# This file is managed by Ansible.
# Do not edit this file manually.
# Any changes will be automatically reverted.
#

# This needs to be in your server's config somewhere, probably
# the main httpd.conf
{% if graphite_apache_port != 80 and graphite_apache_port != 443 %}
Listen {{ graphite_apache_port }}
NameVirtualHost *:{{ graphite_apache_port }}
{% endif %}

# XXX You need to set this up!
# Read http://code.google.com/p/modwsgi/wiki/ConfigurationDirectives#WSGISocketPrefix
WSGISocketPrefix run/wsgi

<VirtualHost *:{{ graphite_apache_port }}>
        # I've found that an equal number of processes & threads tends
        # to show the best performance for Graphite (ymmv).
        #WSGIDaemonProcess graphite processes=1 threads=5 display-name='%{GROUP}' inactivity-timeout=120 python-path=/home/hbi/hbi/lib/python/:/home/jtyr/lib/python
        WSGIDaemonProcess graphite processes=1 threads=5 display-name='%{GROUP}' inactivity-timeout=120
        WSGIProcessGroup graphite
        WSGIApplicationGroup %{GLOBAL}
        WSGIImportScript {{ graphite_root_dir }}/graphite-web.wsgi process-group=graphite application-group=%{GLOBAL}

        # XXX You will need to create this file! There is a graphite.wsgi.example
        # file in this directory that you can safely use, just copy it to graphite.wgsi
        WSGIScriptAlias / {{ graphite_root_dir }}/graphite-web.wsgi

        Alias /content/ {{ graphite_root_dir }}/webapp/content/
        <Location "/content/">
                SetHandler None
        </Location>

        # XXX In order for the django admin site media to work you
        # must change @DJANGO_ROOT@ to be the path to your django
        # installation, which is probably something like:
        # /usr/lib/python2.6/site-packages/django
        Alias /media/ "{{ graphite_django_dir }}/contrib/admin/media/"
        <Location "/media/">
                SetHandler None
        </Location>

        # The graphite.wsgi file has to be accessible by apache. It won't
        # be visible to clients because of the DocumentRoot though.
        <Directory {{ graphite_root_dir }}>
                Order deny,allow
                Allow from all
        </Directory>

        {%- if graphite_apache_cors -%}
        {{ "\n" }}
        # CORS (Cross Origin Resource Sharing) for Grafana
        Header set Access-Control-Allow-Origin "{{ graphite_apache_cors_origin }}"
        Header set Access-Control-Allow-Methods "GET, OPTIONS, POST"
        Header set Access-Control-Allow-Headers "origin, authorization, accept"
        {%- endif -%}
        {{ "\n" }}
</VirtualHost>
